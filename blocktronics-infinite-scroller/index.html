<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>ansilove.js</title>
    <script src="../ansilove.js" type="text/javascript" charset="utf-8"></script>
    <style type="text/css" media="screen">
    body {
        background: black;
        margin: 0;
        overflow: hidden;
    }
    .center {
        margin: 0px auto;
    }
    #ansi {
        width: 1280px;
        margin: 0 auto;
    }
    #ansi canvas {
        image-rendering: optimize-contrast;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: -moz-crisp-edges;
    }
    </style>
</head>
    <body>
        <div id="ansi" class="center"></div>
        
<script type="text/javascript">
(function init() {
    "use strict";

    function httpGetList(url, callback, callbackFail) {
        var http;
        http = new XMLHttpRequest();
        http.open("GET", url, true);
        http.onreadystatechange = function () {
            if (http.readyState === 4) {
                switch (http.status) {
                case 0:
                case 200:
                    callback(http.response.split("\n").filter(function (text) { return text !== ""; }));
                    break;
                default:
                    console.log(callbackFail);
                    if (callbackFail) {
                        callbackFail();
                    } else {
                        throw ("Could not retrieve: " + url);
                    }
                }
            }
        };
        http.responseType = "text";
        http.send();
    }

    httpGetList("file_list.txt", function (ANS) {
        (function loadAns() {
            var controller;

            function randomAns() {
                return encodeURIComponent(ANS[Math.floor(Math.random() * ANS.length)]);
            }

            controller = AnsiLove.animate(randomAns(), function (canvas) {
                canvas.style.width = (canvas.width) * 2 + "px";
                canvas.style.height = (canvas.height) * 2 + "px";
                document.getElementById("ansi").appendChild(canvas);
                (function start() {
                    controller.play(14400, function () {
                        (function reload() {
                            controller.load(randomAns(), function () {
                                setTimeout(start, 3000);
                            }, reload);
                        }());
                    }, false);
                }());
            }, {"font": "80x25", "2J": 0, "rows": Math.ceil(window.innerHeight / 32)}, function () {
                setTimeout(loadAns, 3000);
            });
        }());
    }, function () {
        setTimeout(init, 3000);
    });
}());
</script>
        
    </body>
</html>